<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Civilization vs. Zombies</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            overflow: hidden;
            background-color: #e0e0e0;
        }
        #simulation-area {
            width: 100vw;
            height: 100vh;
            position: relative;
            background-color: #87ceeb;
        }
        #ui-container {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 5px;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.17.1/matter.min.js"></script>
</head>
<body>
    <div id="simulation-area"></div>
    <div id="ui-container">
        <p>Resources: Wood <span id="wood-count">100</span>, Stone <span id="stone-count">50</span>, Food <span id="food-count">200</span></p>
        <button onclick="setBuildingMode('human')">Create Human</button>
        <button onclick="setBuildingMode('armyHuman')">Create Army Human</button>
        <button onclick="setBuildingMode('building')">Create Building</button>
        <button onclick="setBuildingMode('tank')">Create Tank</button>
        <button onclick="setBuildingMode(null)">Select</button>
        <p id="building-mode">Mode: Select</p>
    </div>

    <script>
        const { Engine, World, Bodies, Composite, Render, Runner, Mouse, MouseConstraint, Vector } = Matter;

        let engine;
        let world;
        let humans = [];
        let zombies = [];
        let buildings = [];
        let tanks = [];
        let resources = { wood: 100, stone: 50, food: 200 };
        let gameTime = 0;
        let isNight = false;
        let buildingMode = null;
        let heldObject = null;
        let mouseDownTime = 0;

        function init() {
            // ... (Matter.js setup as before) ...
            engine = Engine.create();
            world = engine.world;

            const render = Render.create({
                element: document.getElementById('simulation-area'),
                engine: engine,
                options: {
                    width: window.innerWidth,
                    height: window.innerHeight,
                    wireframes: false,
                    background: '#87ceeb'
                }
            });

            Render.run(render);

            const runner = Runner.create();
            Runner.run(runner, engine);

            createHuman(400, 300, 'normal');

            setInterval(update, 16);

            const mouse = Mouse.create(render.canvas);
            const mouseConstraint = MouseConstraint.create(engine, {
                mouse: mouse,
                constraint: {
                    stiffness: 0.2,
                    render: { visible: false }
                }
            });

            World.add(world, mouseConstraint);

            render.mouse = mouse;

            Matter.Events.on(mouseConstraint, 'mousedown', (event) => {
                mouseDownTime = Date.now();
                heldObject = event.source.body;
            });

            Matter.Events.on(mouseConstraint, 'mouseup', (event) => {
                const timeDiff = Date.now() - mouseDownTime;
                if (timeDiff > 500 && heldObject) {
                    deleteObject(heldObject);
                } else if(buildingMode){
                    placeObject(event.mouse.position.x, event.mouse.position.y);
                }
                heldObject = null;
            });

        }

        function update() {
            // ... (update logic as before) ...
            gameTime++;
            if (gameTime % 600 === 0) {
                isNight = !isNight;
                if (isNight) {
                    spawnZombies();
                }
                updateBackground();
            }

            humans.forEach(human => human.update());
            zombies.forEach(zombie => zombie.update());
            tanks.forEach(tank => tank.update());

            handleCollisions();
            updateUI();
        }

        // ... (other functions: updateBackground, setBuildingMode, placeObject, deleteObject) ...
        function placeObject(x, y){
            if(buildingMode === 'human'){
                createHuman(x,y, 'normal');
            } else if (buildingMode === 'armyHuman'){
                createHuman(x,y, 'army');
            } else if (buildingMode === 'building'){
                createBuilding(x,y);
            } else if (buildingMode === 'tank'){
                createTank(x,y);
            }
        }
        function createHuman(x, y, type) {
            if (resources.food < 1) { return; }
            resources.food -= 1;
            const body = Bodies.circle(x, y, 20, {render: {fillStyle: type === 'army' ? 'green' : 'white'}});
            World.add(world, body);
            const human = {
                body: body,
                health: 100,
                type: type,
                swordColor: type === 'army' ? 'red' : 'green',
                attackCooldown: 0,
                update: () => {
                    if (Math.random() < 0.01) {
                        Matter.Body.setVelocity(human.body, { x: (Math.random() - 0.5) * 5, y: (Math.random() - 0.5) * 5 });
                    }
                    if(human.attackCooldown > 0){
                        human.attackCooldown--;
                    }
                }
            };
            humans.push(human);
        }
        function createTank(x,y){
            if (resources.wood < 30 || resources.stone < 20) { return; }
            resources.wood -= 30;
            resources.stone -= 20;

            const body = Bodies.rectangle(x, y, 60, 40, { render: { fillStyle: 'gray' } });
            World.add(world, body);
            const tank = {
                body: body,
                health: 200,
                attackCooldown: 0,
                update: () => {
                    if(tank.attackCooldown > 0){
                        tank.attackCooldown--;
                    }
                    let closestZombie = null;
                    let closestDistance = Infinity;
                    zombies.forEach(zombie => {
                        const distance = Vector.magnitude(Vector.sub(zombie.body.position, tank.body.position));
                        if (distance < closestDistance) {
                            closestDistance = distance;
                            closestZombie = zombie;
                        }
                    });
                    if (closestZombie && tank.attackCooldown === 0) {
                        handleTankAttack(tank, closestZombie);
                        tank.attackCooldown = 50;
                    }

                }
            };
            tanks.push(tank);
        }
        function handleTankAttack(tank, zombie){
            zombie.health -= 30;
            if(zombie.health <= 0){
                World.remove(world, zombie.body);
                zombies = zombies.filter(z => z !== zombie);
            }
        }
        // ... (createBuilding, spawnZombies, handleCollisions, handleCombat, updateUI) ...
        function handleCombat(humanBody, zombieBody){
            const human = humans.find(h => h.body === humanBody);
            const zombie = zombies.find(z => z.body === zombieBody);
            if (human && zombie && human.attackCooldown === 0){
                let damage = human.type === 'army' ? 20 : 10;
                zombie.health -= damage;
                human.attackCooldown = 20;
                if(zombie.health <= 0){World.remove(world,zombie.body); zombies = zombies.filter(z => z !== zombie);}
            }
        }
    </script>
</body>
</html>
