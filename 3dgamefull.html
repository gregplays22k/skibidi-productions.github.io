<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Civilization vs. Zombies</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            overflow: hidden;
            background-color: #e0e0e0;
        }
        #simulation-area {
            width: 100vw;
            height: 100vh;
            position: relative;
            background-color: #87ceeb;
        }
        #ui-container {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 5px;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.17.1/matter.min.js"></script>
</head>
<body>
    <div id="simulation-area"></div>
    <div id="ui-container">
        <p>Resources: Wood <span id="wood-count">100</span>, Stone <span id="stone-count">50</span>, Food <span id="food-count">200</span></p>
        <button onclick="setBuildingMode('human')">Create Human</button>
        <button onclick="setBuildingMode('armyHuman')">Create Army Human</button>
        <button onclick="setBuildingMode('building')">Create Building</button>
        <button onclick="setBuildingMode('tank')">Create Tank</button>
        <button onclick="setBuildingMode(null)">Select</button>
        <p id="building-mode">Mode: Select</p>
        <button onclick="toggleFightMode()">Toggle Fight Mode</button>
        <button onclick="startZombieWar()">Start Zombie War</button>
        <button onclick="toggleTakeoverMode()">Toggle Takeover Mode</button>
    </div>

    <script>
        const { Engine, World, Bodies, Composite, Render, Runner, Mouse, MouseConstraint, Vector } = Matter;

        let engine;
        let world;
        let humans = [];
        let zombies = [];
        let buildings = [];
        let tanks = [];
        let resources = { wood: 100, stone: 50, food: 200 };
        let gameTime = 0;
        let isNight = false;
        let buildingMode = null;
        let heldObject = null;
        let mouseDownTime = 0;
        let fightMode = false;
        let zombieSpawnInterval = null;
        let takeoverMode = false;
        let controlledHuman = null;
        let keys = {};

        function init() {
            engine = Engine.create();
            world = engine.world;

            const render = Render.create({
                element: document.getElementById('simulation-area'),
                engine: engine,
                options: {
                    width: window.innerWidth,
                    height: window.innerHeight,
                    wireframes: false,
                    background: '#87ceeb'
                }
            });

            Render.run(render);

            const runner = Runner.create();
            Runner.run(runner, engine);

            const ground = Bodies.rectangle(window.innerWidth / 2, window.innerHeight - 25, window.innerWidth, 50, { isStatic: true, render: { fillStyle: 'brown' } });
            World.add(world, ground);

            createHuman(400, 300, 'normal');

            setInterval(update, 16);
            setInterval(createResourceBox, 15000);
            setInterval(createAnimal, 10000);

            const mouse = Mouse.create(render.canvas);
            const mouseConstraint = MouseConstraint.create(engine, {
                mouse: mouse,
                constraint: {
                    stiffness: 0.2,
                    render: { visible: false }
                }
            });

            World.add(world, mouseConstraint);
            render.mouse = mouse;

            Matter.Events.on(mouseConstraint, 'mousedown', (event) => {
                mouseDownTime = Date.now();
                heldObject = event.source.body;
            });

            Matter.Events.on(mouseConstraint, 'mouseup', (event) => {
                const timeDiff = Date.now() - mouseDownTime;
                if (timeDiff > 500 && heldObject) {
                    deleteObject(heldObject);
                } else if (buildingMode) {
                    placeObject(event.mouse.position.x, event.mouse.position.y);
                } else if (event.source.body && event.source.body.resourceType) {
                    resources[event.source.body.resourceType] += event.source.body.resourceAmount;
                    World.remove(world, event.source.body);
                } else if (takeoverMode && humans.some(human => human.body === event.source.body)) {
                    controlledHuman = humans.find(human => human.body === event.source.body);
                }
                heldObject = null;
            });

            document.addEventListener('keydown', (event) => {
                keys[event.key] = true;
            });
            document.addEventListener('keyup', (event) => {
                keys[event.key] = false;
            });
        }

        function update() {
            gameTime++;
            if (gameTime % 600 === 0) {
                isNight = !isNight;
                updateBackground();
            }

            humans.forEach(human => {
                human.update();
                if (human.sick && Math.random() < 0.001) {
                    World.remove(world, human.body);
                    humans = humans.filter(h => h !== human);
                }
            });
            zombies.forEach(zombie => zombie.update());
            tanks.forEach(tank => tank.update());

            handleCollisions();
            updateUI();

            if (controlledHuman) {
                if (keys['ArrowLeft']) {
                    Matter.Body.setVelocity(controlledHuman.body, { x: -5, y: controlledHuman.body.velocity.y });
                }
                if (keys['ArrowRight']) {
                    Matter.Body.setVelocity(controlledHuman.body, { x: 5, y: controlledHuman.body.velocity.y });
                }
            }
        }

        function updateBackground() {
            const simulationArea = document.getElementById('simulation-area');
            simulationArea.style.background = isNight ? '#191970' : '#87ceeb';
        }

        function setBuildingMode(mode) {
            buildingMode = mode;
            document.getElementById('building-mode').textContent = `Mode: ${mode ? mode : "Select"}`;
        }

        function placeObject(x, y) {
            if (buildingMode === 'human') {
                createHuman(x, y, 'normal');
            } else if (buildingMode === 'armyHuman') {
                createHuman(x, y, 'army');
            } else if (buildingMode === 'building') {
                createBuilding(x, y);
            } else if (buildingMode === 'tank') {
                createTank(x, y);
            }
        }

        function deleteObject(body) {
            if (humans.some(human => human.body === body)) {
                let human = humans.find(h => h.body === body);
                World.remove(world, body);
                humans = humans.filter(h => h !== human);
            } else if (zombies.some(zombie => zombie.body === body)) {
                let zombie = zombies.find(z => z.body === body);
                World.remove(world, body);
                zombies = zombies.filter(z => z !== zombie);
            } else if (buildings.some(building => building === body)) {
                World.remove(world, body);
                buildings = buildings.filter(b => b !== body);
            } else if (tanks.some(tank => tank.body === body)) {
                World.remove(world, body);
                tanks = tanks.filter(t => t !== tank);
            }
        }

        function createHuman(x, y, type) {
            if (resources.food < 1) { return; }
            resources.food -= 1;
            const body = Bodies.circle(x, y, 20,
