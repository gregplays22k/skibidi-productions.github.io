<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Civilization vs. Zombies</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            overflow: hidden;
            background-color: #e0e0e0;
        }
        #simulation-area {
            width: 100vw;
            height: 100vh;
            position: relative;
            background-color: #87ceeb; /* Light blue sky */
        }
        #ui-container {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 5px;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.17.1/matter.min.js"></script>
</head>
<body>
    <div id="simulation-area"></div>
    <div id="ui-container">
        <p>Resources: Wood <span id="wood-count">100</span>, Stone <span id="stone-count">50</span>, Food <span id="food-count">200</span></p>
        <button onclick="setBuildingMode('human')">Create Human</button>
        <button onclick="setBuildingMode('building')">Create Building</button>
        <button onclick="setBuildingMode(null)">Select</button>
        <p id="building-mode">Mode: Select</p>
    </div>

    <script>
        const { Engine, World, Bodies, Composite, Render, Runner, Mouse, MouseConstraint } = Matter;

        let engine;
        let world;
        let humans = [];
        let zombies = [];
        let buildings = [];
        let resources = { wood: 100, stone: 50, food: 200 };
        let gameTime = 0;
        let isNight = false;
        let buildingMode = null;
        let heldObject = null;
        let mouseDownTime = 0;

        function init() {
            engine = Engine.create();
            world = engine.world;

            const render = Render.create({
                element: document.getElementById('simulation-area'),
                engine: engine,
                options: {
                    width: window.innerWidth,
                    height: window.innerHeight,
                    wireframes: false,
                    background: '#87ceeb'
                }
            });

            Render.run(render);

            const runner = Runner.create();
            Runner.run(runner, engine);

            createHuman(400, 300);

            setInterval(update, 16);

            const mouse = Mouse.create(render.canvas);
            const mouseConstraint = MouseConstraint.create(engine, {
                mouse: mouse,
                constraint: {
                    stiffness: 0.2,
                    render: { visible: false }
                }
            });

            World.add(world, mouseConstraint);

            render.mouse = mouse;

            Matter.Events.on(mouseConstraint, 'mousedown', (event) => {
                mouseDownTime = Date.now();
                heldObject = event.source.body;
            });

            Matter.Events.on(mouseConstraint, 'mouseup', (event) => {
                const timeDiff = Date.now() - mouseDownTime;
                if (timeDiff > 500 && heldObject) {
                    deleteObject(heldObject);
                } else if(buildingMode){
                    placeObject(event.mouse.position.x, event.mouse.position.y);
                }
                heldObject = null;
            });

        }

        function update() {
            gameTime++;
            if (gameTime % 600 === 0) {
                isNight = !isNight;
                if (isNight) {
                    spawnZombies();
                }
                updateBackground();
            }

            humans.forEach(human => human.update());
            zombies.forEach(zombie => zombie.update());

            handleCollisions();
            updateUI();
        }

        function updateBackground() {
            const simulationArea = document.getElementById('simulation-area');
            simulationArea.style.background = isNight ? '#191970' : '#87ceeb';
        }
        function setBuildingMode(mode){
            buildingMode = mode;
            document.getElementById('building-mode').textContent = `Mode: ${mode ? mode : "Select"}`;
        }
        function placeObject(x, y){
          if(buildingMode === 'human'){
            createHuman(x,y);
          } else if (buildingMode === 'building'){
            createBuilding(x,y);
          }
        }
        function deleteObject(body){
          if(humans.some(human => human.body === body)){
            let human = humans.find(h => h.body === body);
            World.remove(world, body);
            humans = humans.filter(h => h !== human);
          } else if (zombies.some(zombie => zombie.body === body)){
            let zombie = zombies.find(z => z.body === body);
            World.remove(world, body);
            zombies = zombies.filter(z => z !== zombie);
          } else if (buildings.some(building => building === body)){
            World.remove(world, body);
            buildings = buildings.filter(b => b !== body);
          }
        }

        function createHuman(x, y) {
            if (resources.food < 1) { return; }
            resources.food -= 1;
            const body = Bodies.circle(x, y, 20);
            World.add(world, body);
            const human = {
                body: body,
                health: 100,
                update: () => {
                    if (Math.random() < 0.01) {
                        Matter.Body.setVelocity(human.body, { x: (Math.random() - 0.5) * 5, y: (Math.random() - 0.5) * 5 });
                    }
                }
            };
            humans.push(human);
        }

        function createBuilding(x, y) {
            if (resources.wood < 10 || resources.stone < 5) { return; }
            resources.wood -= 10;
            resources.stone -= 5;
            const body = Bodies.rectangle(x, y, 50, 50, { isStatic: true, render: { fillStyle: 'brown' } });
            World.add(world, body);
            buildings.push(body);
        }

        function spawnZombies() {
            const zombie = {
                body: Bodies.rectangle(Math.random() * window.innerWidth, 0, 30, 30, { render: { fillStyle: 'green' } }),
                health: 50,
                update: () => {
                    let closestHuman = null;
                    let closestDistance = Infinity;
                    humans.forEach(human => {
                        const distance = Matter.Vector.magnitude(Matter.Vector.sub(human.body.position, zombie.body.position));
                        if (distance < closestDistance) {
                            closestDistance = distance;
                            closestHuman = human;
                        }
                    });
                    if (closestHuman) {
                        const direction = Matter.Vector.normalise(Matter.Vector.sub(closestHuman.body.position, zombie.body.position));
                        Matter.Body.setVelocity(zombie.body, { x: direction.x * 2, y: direction.y * 2 });
                    }
                }
            };
            zombies.push(zombie);
            World.add(world, zombie.body);
        }

        function handleCollisions() {
            Matter.Events.on(engine, 'collisionStart', (event) => {
                event.pairs.forEach(pair => {
                    const bodyA = pair.bodyA;
                    const bodyB = pair.bodyB;

                    if (humans.some(human => human.body === bodyA) && zombies.some(zombie => zombie.body === bodyB)) {
                        handleCombat(bodyA, bodyB);
                    } else if (zombies.some(zombie => zombie.body === bodyA) && humans.some(human => human.body === bodyB)) {
                        handleCombat(bodyB, body
